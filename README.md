# Система управления бизнесом

Полнофункциональная система управления бизнесом с фронтендом на Vue.js/Vite и бэкендом на NestJS.

## Структура проекта

```
business-management-system/
├── frontend/            # Фронтенд на Vue.js с Vite
│   └── CVET/            # Основное приложение
├── backend/             # Бэкенд на NestJS
└── README.md            # Данный файл
```

## Требования

- Node.js 18+ (рекомендуется 20+)
- npm 9+
- PostgreSQL 15+ или SQLite (для разработки)

## Установка

### Установка всех зависимостей

```bash
# Установка всех зависимостей (корневого проекта, бэкенда и фронтенда)
npm run install:all
```

## Запуск для разработки

```bash
# Запуск всего проекта (бэкенд и фронтенд одновременно)
npm start

# Запуск только бэкенда
npm run start:backend

# Запуск только фронтенда
npm run start:frontend
```

После запуска:
- Фронтенд будет доступен по адресу: http://localhost:8080
- Бэкенд API будет доступен по адресу: http://localhost:3000
- API документация (Swagger): http://localhost:3000/api

## Сборка для продакшена

```bash
# Сборка всего проекта
npm run build

# Сборка только бэкенда
npm run build:backend

# Сборка только фронтенда
npm run build:frontend
```

После сборки:
- Фронтенд будет собран в директории `frontend/CVET/dist/`
- Бэкенд будет собран в директории `backend/dist/`

## Преимущества использования Vite

Проект использует Vite вместо устаревшего Vue CLI, что обеспечивает:

1. **Более быструю разработку** - мгновенное обновление страницы при изменениях (HMR)
2. **Оптимизированную сборку** - разделение кода, tree-shaking и ES модули
3. **Современный инструментарий** - поддержка TypeScript, CSS модулей и т.д.
4. **Меньший объем конфигурации** - разумные значения по умолчанию
5. **Лучшую производительность** - оптимизация для современных браузеров

## Особенности проекта

- **Фронтенд**: Vue 3 с Composition API, Vue Router, Vuex, TailwindCSS
- **Бэкенд**: NestJS, TypeORM, Swagger, JWT аутентификация
- **База данных**: PostgreSQL или SQLite
- **Интеграции**: Поддержка календаря, графиков, WebSocket для уведомлений

## Схема проекта

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       Система управления бизнесом                       │
└───────────────────────────────┬─────────────────────────────────────────┘
                                │
    ┌───────────────────────────┼────────────────────────┐
    │                           │                        │
┌───▼───────────────┐    ┌──────▼─────────┐     ┌────────▼────────┐
│  Frontend (Vue.js) │    │ Backend (NestJS) │     │ Telegram Bot    │
└───────┬───────────┘    └──────┬─────────┘     └────────┬────────┘
        │                       │                        │
        │  ┌───────────────────▼────────────────────────▼──────┐
        │  │                  База данных                       │
        │  │               (PostgreSQL)                         │
        │  └────────────────────────────────────────────────────┘
        │
┌───────▼───────────────────────────────────────────────────────┐
│                      Админ-панель                             │
├─────────────────────────────────────────────────────────────┐ │
│ ┌──────────┐ ┌───────────┐ ┌────────────┐ ┌──────────────┐ │ │
│ │ Дашборд  │ │ Записи    │ │ Клиенты    │ │ Услуги       │ │ │
│ └──────────┘ └───────────┘ └────────────┘ └──────────────┘ │ │
│ ┌──────────┐ ┌───────────┐ ┌────────────┐                  │ │
│ │ Филиалы  │ │ Статистика│ │ Настройки  │                  │ │
│ └──────────┘ └───────────┘ └────────────┘                  │ │
└─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                     Backend Модули (NestJS)                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐ ┌─────────────┐ ┌───────────────┐ ┌─────────┐ │
│  │  Auth       │ │ Users       │ │ Appointments  │ │ Clients │ │
│  └─────────────┘ └─────────────┘ └───────────────┘ └─────────┘ │
│                                                                 │
│  ┌─────────────┐ ┌─────────────┐ ┌───────────────┐ ┌─────────┐ │
│  │  Services   │ │ Branches    │ │ Sales         │ │ Telegram│ │
│  └─────────────┘ └─────────────┘ └───────────────┘ └─────────┘ │
│                                                                 │
│  ┌─────────────┐ ┌─────────────┐ ┌───────────────┐            │
│  │Notifications│ │Integrations │ │ Web           │            │
│  └─────────────┘ └─────────────┘ └───────────────┘            │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                 Основные сущности базы данных                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐      ┌───────────────┐      ┌───────────────┐ │
│  │  User       │      │ Client        │      │ Branch        │ │
│  └──────┬──────┘      └───────┬───────┘      └───────┬───────┘ │
│         │                     │                      │         │
│         │                     │                      │         │
│  ┌──────▼──────┐      ┌───────▼───────┐      ┌───────▼───────┐ │
│  │ Appointment │◄─────┤ Service       │◄─────┤ Sale          │ │
│  └─────────────┘      └───────────────┘      └───────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                 Процесс записи через Telegram                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  /start                                                         │
│    │                                                            │
│    ▼                                                            │
│  Запись на прием                                                │
│    │                                                            │
│    ▼                                                            │
│  Ввод имени и телефона ──► Создание клиента                     │
│    │                                                            │
│    ▼                                                            │
│  Выбор филиала ──────────► Получение списка филиалов из БД      │
│    │                                                            │
│    ▼                                                            │
│  Выбор услуги ───────────► Получение списка услуг из БД         │
│    │                                                            │
│    ▼                                                            │
│  Выбор даты                                                     │
│    │                                                            │
│    ▼                                                            │
│  Выбор времени ──────────► Проверка доступности слотов          │
│    │                                                            │
│    ▼                                                            │
│  Подтверждение записи ───► Создание записи в БД                 │
│    │                         │                                  │
│    ▼                         ▼                                  │
│  Уведомление клиента      Уведомление администратора            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 1. Функциональность проекта

### 1.1 Telegram Бот

**Основные возможности:**
- (✓) **Запись на прием** - клиенты могут самостоятельно записаться на процедуру
- (✓) **Выбор филиала** - выбор из доступных филиалов компании
- (✓) **Выбор услуги** - просмотр и выбор услуг с описанием и ценами
- (✓) **Выбор даты и времени** - интерактивный выбор свободного времени
- (✓) **Отмена записи** - возможность отменить свою запись
- (✓) **Просмотр своих записей** - история записей клиента
- (✓) **Просмотр прайс-листа** - актуальный список услуг и цен

**Административные функции:**
- (✓) **Управление записями** - администратор может просматривать все записи
- (✓) **Просмотр записей на сегодня/завтра** - фильтрация по дате
- (✓) **Отмена записей** - возможность отменить любую запись с указанием причины
- (✓) **Уведомления** - автоматические уведомления о новых записях

### 1.2 Backend (API)

**Основные модули:**
- (✓) **Аутентификация и авторизация** - JWT-токены, защита админ-панели
- (✓) **Модуль клиентов** - управление данными клиентов
- (✓) **Модуль услуг** - управление услугами, ценами, категориями
- (✓) **Модуль филиалов** - управление информацией о местоположениях
- (✓) **Модуль расписания** - управление доступным временем и слотами
- (✓) **Модуль записей** - создание, изменение, отмена записей
- (✓) **Система уведомлений** - отправка уведомлений в Telegram
- (✓) **Управление пользователями** - создание и управление аккаунтами

**Технические особенности:**
- (✓) **REST API** - полный набор эндпоинтов для взаимодействия с системой
- (✓) **Интеграция с Telegram API** - бесшовная работа с Telegram Bot API
- (✓) **База данных** - поддержка PostgreSQL и SQLite
- (✓) **Кэширование** - оптимизация производительности
- (✓) **Логирование** - детальное отслеживание работы системы

### 1.3 Frontend (Админ-панель)

**Основные разделы:**
- (✓) **Дашборд** - сводка ключевых показателей и активности
- (✓) **Управление записями** - просмотр, создание, редактирование записей
- (✓) **Управление клиентами** - база данных клиентов
- (✓) **Управление услугами** - настройка услуг и цен
- (✓) **Управление филиалами** - настройка локаций и расписания
- (✓) **Настройки системы** - конфигурация параметров работы
- (✓) **Статистика и отчеты** - анализ данных и формирование отчетов

## 2. Техническая структура

### 2.1 Frontend

**Технологический стек:**
- **Vue.js** - прогрессивный JavaScript-фреймворк
- **Vuex** - централизованное управление состоянием
- **Vue Router** - маршрутизация внутри приложения
- **API-клиент** - axios для взаимодействия с backend
- **UI компоненты** - современный адаптивный интерфейс

**Ключевые особенности:**
- **Адаптивный дизайн** - корректное отображение на всех устройствах
- **Интерактивные элементы** - календарь, расписание, формы
- **Реактивное обновление данных** - мгновенное отображение изменений
- **Защищенный доступ** - авторизация для администраторов
- **Поддержка различных браузеров** - кроссбраузерная совместимость

### 2.2 Backend

**Технологический стек:**
- **Node.js** - серверная платформа
- **NestJS** - фреймворк для масштабируемых приложений
- **TypeORM** - работа с базами данных
- **PostgreSQL/SQLite** - хранение данных
- **Telegraf** - работа с Telegram Bot API
- **JWT** - авторизация и аутентификация
- **TypeScript** - типизация для большей надежности кода

**Архитектура:**
- **Модульная структура** - изолированные компоненты
- **Dependency Injection** - управление зависимостями
- **Repository Pattern** - доступ к данным
- **Service Pattern** - бизнес-логика
- **DTO Pattern** - валидация данных
- **REST API** - стандартизированные эндпоинты

## 3. Развертывание

### 3.1 Требования
- Node.js v14+
- PostgreSQL (опционально, можно использовать SQLite)
- Telegram Bot Token (от @BotFather)

### 3.2 Установка
1. Клонировать репозиторий
2. Настроить .env файл
3. Установить зависимости (`npm install` в папках frontend и backend)
4. Запустить бэкенд (`npm run start:dev` в папке backend)
5. Запустить фронтенд (`npm run dev` в папке frontend)

## 4. Использование

### 4.1 Telegram Бот
1. Запустите бота отправив команду `/start`
2. Выберите действие (Записаться, Мои записи, Прайс)
3. Следуйте инструкциям бота для создания записи

### 4.2 Админ-панель
1. Откройте веб-интерфейс по адресу http://localhost:3001
2. Войдите в систему с учетными данными администратора
3. Получите доступ к полному функционалу управления бизнесом

## 5. Интеграция Telegram-бота и веб-панели управления

### 5.1 Синхронизация записей на услугу "Радужка"

Система обеспечивает полную интеграцию между Telegram-ботом и веб-панелью администратора для управления записями на услугу диагностики радужки глаза:

- **Мгновенная синхронизация** - записи, созданные через Telegram-бот, немедленно отображаются в веб-панели администратора
- **Двустороннее управление** - администратор может управлять записями как из Telegram, так и через веб-интерфейс
- **Уведомления в обе стороны** - при изменении статуса записи в любом из интерфейсов, уведомления отправляются во все каналы связи
- **Полная информация о клиенте** - администратор видит полную историю взаимодействия с клиентом
- **Интерактивный календарь** - наглядное отображение всех записей на услугу "Радужка" в административной панели

### 5.2 Процесс работы с записями на радужку

1. **Запись через Telegram-бот**:
   - Клиент выбирает услугу "Диагностика радужки" в Telegram-боте
   - Выбирает филиал, дату и время
   - Подтверждает запись

2. **Отображение в панели администратора**:
   - Запись мгновенно появляется в разделе "Записи" веб-интерфейса
   - Администратор получает уведомление о новой записи
   - Запись отмечается специальным индикатором как "Запись на радужку"

3. **Управление записью**:
   - Администратор может изменить статус записи (подтвердить, отменить, перенести)
   - Может добавить комментарии к записи
   - Может связаться с клиентом через интерфейс системы

4. **Синхронизация изменений**:
   - Любые изменения записи в веб-интерфейсе отражаются в Telegram-боте
   - Клиент получает уведомления об изменении статуса своей записи
   - История всех изменений сохраняется в системе

## 6. Управление услугами и прайс-листом

### 6.1 Модуль управления услугами

Система предоставляет удобный интерфейс для управления услугами и прайс-листом, который синхронизируется с Telegram-ботом:

- **Полный контроль над прайс-листом** - администратор может добавлять, редактировать и удалять услуги
- **Категоризация услуг** - разделение услуг по категориям для удобного поиска
- **Специальная категория "Диагностика радужки"** - выделенный раздел для работы с основной услугой клиники
- **Управление ценами и длительностью** - настройка стоимости и продолжительности каждой услуги
- **Активация/деактивация услуг** - возможность временно скрыть услуги без их удаления из базы данных

### 6.2 Синхронизация с Telegram-ботом

Все изменения, внесенные в прайс-лист через админ-панель, автоматически отражаются в Telegram-боте:

1. **Обновление прайса в реальном времени**:
   - При добавлении или изменении услуги в админ-панели, эти изменения сразу доступны в боте
   - Клиенты всегда видят актуальные цены и описания услуг

2. **Управление доступностью услуг**:
   - Деактивированные услуги не отображаются в боте
   - При активации услуги, она немедленно становится доступной для выбора клиентам

3. **Категоризация услуг в боте**:
   - Услуги в Telegram-боте группируются по тем же категориям, что и в админ-панели
   - Категория "Диагностика радужки" выделяется для удобства клиентов

### 6.3 Особенности работы с услугой "Диагностика радужки"

Как основная специализация клиники, услуга диагностики радужки получает специальное выделение в системе:

- **Визуальная маркировка** - услуги диагностики радужки отмечаются специальным значком 👁️
- **Выделенное отображение** - такие услуги имеют особый стиль в интерфейсе админ-панели
- **Приоритетное положение** - услуги этой категории отображаются первыми в списке
- **Специальная статистика** - отдельный учет записей на диагностику радужки в отчетах

## 7. Контакты и поддержка

Система разработана для "Цвет Взгляда" - компании по диагностике радужки глаза.

© 2025 Цвет Взгляда. Все права защищены.

## 8. Последние обновления и улучшения

### 8.1 Улучшенный интерфейс управления услугами

В последнем обновлении системы были реализованы следующие улучшения:

1. **Модернизированный компонент управления услугами и прайс-листом**:
   - Полностью русифицированный интерфейс
   - Улучшенная визуальная организация услуг в виде карточек
   - Фильтрация и поиск услуг по названию и категории
   - Сортировка услуг по различным параметрам (название, цена, длительность)

2. **Специальная маркировка услуг радужки**:
   - Визуальное выделение услуг диагностики радужки значком 👁️
   - Особое цветовое оформление карточек услуг категории "Диагностика радужки"
   - Приоритетное расположение в списке услуг

3. **Расширенная категоризация услуг**:
   - Добавлены предустановленные категории: "Диагностика радужки", "Маникюр", "Педикюр", "Прическа", "Макияж", "Массаж"
   - Возможность фильтрации услуг по категориям
   - Интуитивно понятный интерфейс для добавления новых категорий

4. **Улучшенная синхронизация с Telegram-ботом**:
   - Автоматическое обновление прайс-листа в боте при изменениях в админ-панели
   - Корректное отображение категорий услуг в меню бота
   - Мгновенное отражение статуса доступности услуги (активна/неактивна)
   - Моментальное обновление цен и описаний

5. **Оптимизация интерфейса для администратора**:
   - Улучшенный процесс добавления и редактирования услуг
   - Быстрый доступ к управлению прайс-листом через главное меню
   - Информативные уведомления о результатах операций
   - Валидация данных при создании новых услуг

Все эти улучшения значительно упрощают процесс управления прайс-листом и делают работу с системой более эффективной для администраторов салона "Цвет Взгляда".

# План реструктуризации Business Management System

## Текущая структура
```
business-management-system/
├── frontend/
│   ├── CVET/           # Основной frontend
│   ├── simple-html/    # Устаревшая версия
│   └── src/            # Дополнительный код
│
├── backend/
│   ├── src/
│   │   ├── modules/
│   │   ├── services/
│   │   ├── controllers/
│   │   └── database/
│   │   └── migrations/
│   └── test/
│
├── packages/                  # Общий код
├── docs/                     # Единая документация
├── config/                   # Конфигурации
├── scripts/                  # Автоматизация
└── .github/                  # CI/CD
```

## Целевая структура
```
business-management-system/
├── apps/                      # Монорепозиторий с приложениями
│   ├── frontend/             # Единый frontend
│   │   ├── src/
│   │   │   ├── components/
│   │   │   ├── pages/
│   │   │   ├── hooks/
│   │   │   ├── services/
│   │   │   └── utils/
│   │   └── public/
│   │
│   └── backend/
│       ├── src/
│       │   ├── modules/
│       │   ├── services/
│       │   ├── controllers/
│       │   └── database/
│       │       └── migrations/
│       └── test/
│
├── packages/                  # Общий код
├── docs/                     # Единая документация
├── config/                   # Конфигурации
├── scripts/                  # Автоматизация
└── .github/                  # CI/CD
```

## Пошаговый план миграции

### Фаза 1: Подготовка (1-2 недели)
#### 1.1 Аудит и бэкап (2-3 дня)
- [ ] Создание полного бэкапа всех баз данных
- [ ] Аудит текущего кода и зависимостей
- [ ] Создание ветки разработки для миграции
- [ ] Документирование текущих API эндпоинтов

#### 1.2 Настройка окружения (2-3 дня)
- [ ] Установка PostgreSQL
- [ ] Настройка инструментов для монорепозитория
- [ ] Создание новых конфигурационных файлов
- [ ] Настройка системы управления секретами

#### 1.3 Подготовка CI/CD (2-3 дня)
- [ ] Настройка GitHub Actions
- [ ] Создание пайплайнов для тестирования
- [ ] Настройка автоматического деплоя
- [ ] Создание окружений (dev, staging, prod)

### Фаза 2: Миграция базы данных (2-3 недели)
#### 2.1 Подготовка схемы (1 неделя)
- [ ] Анализ текущей структуры данных
- [ ] Проектирование новой схемы PostgreSQL
- [ ] Создание миграционных скриптов
- [ ] Настройка ORM (TypeORM/Prisma)

#### 2.2 Тестовая миграция (1 неделя)
- [ ] Создание тестовой базы данных
- [ ] Выполнение миграции на тестовой базе
- [ ] Валидация данных
- [ ] Исправление проблем

#### 2.3 Настройка мониторинга БД (3-4 дня)
- [ ] Настройка логирования
- [ ] Настройка метрик производительности
- [ ] Создание алертов
- [ ] Документирование процедур бэкапа

### Фаза 3: Реструктуризация Backend (2-3 недели)
#### 3.1 Модульная структура (1 неделя)
- [ ] Создание новой структуры папок
- [ ] Разделение на модули
- [ ] Внедрение dependency injection
- [ ] Создание общих утилит

#### 3.2 API Gateway (1 неделя)
- [ ] Реализация API Gateway
- [ ] Настройка маршрутизации
- [ ] Внедрение аутентификации
- [ ] Настройка rate limiting

#### 3.3 Тестирование (3-4 дня)
- [ ] Написание unit тестов
- [ ] Настройка интеграционных тестов
- [ ] Создание E2E тестов
- [ ] Настройка coverage отчетов

### Фаза 4: Реорганизация Frontend (3-4 недели)
#### 4.1 Подготовка (1 неделя)
- [ ] Аудит компонентов
- [ ] Создание новой структуры
- [ ] Настройка сборки
- [ ] Настройка линтеров и форматтеров

#### 4.2 Миграция компонентов (2 недели)
- [ ] Перенос общих компонентов
- [ ] Создание новых страниц
- [ ] Внедрение state management
- [ ] Оптимизация производительности

#### 4.3 Тестирование UI (1 неделя)
- [ ] Написание unit тестов
- [ ] Создание E2E тестов
- [ ] Тестирование доступности
- [ ] Кросс-браузерное тестирование

### Фаза 5: Интеграция и оптимизация (2 недели)
#### 5.1 Интеграция систем (1 неделя)
- [ ] Настройка общих типов
- [ ] Интеграция API
- [ ] Настройка WebSocket
- [ ] Тестирование взаимодействия

#### 5.2 Мониторинг и логирование (3-4 дня)
- [ ] Настройка Sentry
- [ ] Внедрение аналитики
- [ ] Настройка логирования
- [ ] Создание дашбордов

#### 5.3 Документация (3-4 дня)
- [ ] Создание API документации
- [ ] Документация архитектуры
- [ ] Руководство по развертыванию
- [ ] Обновление README файлов

### Фаза 6: Запуск (1 неделя)
#### 6.1 Подготовка к запуску (3-4 дня)
- [ ] Финальное тестирование
- [ ] Проверка безопасности
- [ ] Подготовка скриптов отката
- [ ] Создание плана миграции

#### 6.2 Запуск (2-3 дня)
- [ ] Миграция данных
- [ ] Развертывание нового кода
- [ ] Мониторинг систем
- [ ] Поддержка пользователей

## Метрики успеха
- Время отклика API < 100ms
- Покрытие тестами > 80%
- Время развертывания < 15 минут
- Отсутствие критических багов
- Улучшение производительности на 50%

## Риски и митигация
1. Потеря данных
   - Создание множественных бэкапов
   - Тестовые миграции
   - Скрипты отката

2. Простой сервиса
   - Поэтапное развертывание
   - Автоматический откат при ошибках
   - Развертывание в нерабочее время

3. Проблемы совместимости
   - Тщательное тестирование
   - Поддержка старой версии API
   - Постепенный переход

## Контакты и поддержка
- Технический лид: [контакт]
- DevOps инженер: [контакт]
- Команда поддержки: [контакт]

## Ссылки
- [Документация проекта](/docs)
- [API документация](/docs/api)
- [Руководство по развертыванию](/docs/deployment)
- [Архитектурные решения](/docs/architecture)