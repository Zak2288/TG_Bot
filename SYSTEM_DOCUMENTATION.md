# Система управления бизнесом "Цвет Взгляда" - Техническая документация

## 1. Общий обзор системы

Система управления бизнесом "Цвет Взгляда" представляет собой комплексное решение для салонов и клиник, предоставляющих услуги диагностики радужки глаза. Система состоит из трех основных компонентов:

1. **Административная панель (Веб-интерфейс)** - Интерфейс для управления всеми аспектами бизнеса
2. **API (Backend)** - Серверная часть, обеспечивающая бизнес-логику и работу с базой данных
3. **Telegram-бот** - Интерфейс для клиентов, позволяющий записаться на прием

### 1.1 Архитектура системы

```
+-------------------+        +------------------+        +----------------+
|                   |        |                  |        |                |
|  Админ-панель     |<------>|  Backend API    |<------>| Telegram Bot   |
|  (Vue.js)         |        |  (NestJS)       |        |                |
|                   |        |                  |        |                |
+-------------------+        +------------------+        +----------------+
                                     ^
                                     |
                                     v
                             +----------------+
                             |                |
                             | База данных    |
                             | (PostgreSQL)   |
                             |                |
                             +----------------+
```

## 2. Административная панель (Frontend)

### 2.1 Структура интерфейса

Панель управления имеет следующую структуру:

```
+----------------------------------+
|  Шапка (Логотип, Меню, Профиль)  |
+----------------------------------+
|                                  |
|                                  |
|                                  |
|   Содержимое (зависит от        |
|   выбранного раздела)            |
|                                  |
|                                  |
|                                  |
+----------------------------------+
|  Подвал (Информация, Контакты)   |
+----------------------------------+
```

### 2.2 Основные разделы

Административная панель содержит следующие основные разделы:

1. **Панель управления (Dashboard)**
   - Отображение ключевых показателей: записи на сегодня, новые клиенты, продажи и уведомления
   - Календарь с записями
   - Список последних записей
   - Функция быстрого добавления записи

2. **Записи**
   - Список всех записей с возможностью фильтрации
   - Детальная информация о каждой записи
   - Создание, редактирование и удаление записей
   - Управление статусами (запланирована, завершена, отменена, неявка)

3. **Клиенты**
   - База данных клиентов
   - Информация о клиентах (контакты, история записей)
   - Создание и редактирование клиентских профилей

4. **Услуги**
   - Каталог услуг с ценами
   - Категории услуг
   - Управление услугами (добавление, редактирование, деактивация)

5. **Филиалы**
   - Список филиалов компании
   - Информация о каждом филиале (адрес, часы работы, специалисты)
   - Управление филиалами

6. **Статистика**
   - Аналитика по записям
   - Отчеты по продажам
   - Графики и диаграммы

### 2.3 Технический стек Frontend

- **Vue.js** - JavaScript-фреймворк для создания интерфейса
- **Vuex** - Централизованное хранилище данных
- **Vue Router** - Маршрутизация внутри приложения
- **FullCalendar** - Библиотека для работы с календарем
- **Axios** - HTTP-клиент для взаимодействия с API
- **Tailwind CSS** - Утилитарный CSS-фреймворк для стилизации

### 2.4 Процессы пользовательского интерфейса

**Процесс создания записи:**

```
+-------------------+     +-------------------+     +-------------------+
|                   |     |                   |     |                   |
| Выбор клиента     |---->| Выбор услуги      |---->| Выбор даты и      |
| (из списка или    |     | (из доступных     |     | времени (через    |
| создание нового)  |     | в филиале)        |     | календарь)        |
|                   |     |                   |     |                   |
+-------------------+     +-------------------+     +-------------------+
          |                                                 |
          v                                                 v
+-------------------+                            +-------------------+
|                   |                            |                   |
| Добавление        |<---------------------------| Выбор филиала     |
| заметок и         |                            | (если несколько)  |
| сохранение        |                            |                   |
+-------------------+                            +-------------------+
```

## 3. Серверная часть (Backend)

### 3.1 Архитектура Backend

Backend построен на принципах модульной архитектуры:

```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
| Controller Layer |<--->| Service Layer   |<--->| Repository Layer |
| (API Endpoints)  |     | (Business Logic) |     | (Data Access)    |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
                                                         |
                                                         v
                                               +------------------+
                                               |                  |
                                               | Database         |
                                               | (PostgreSQL)     |
                                               |                  |
                                               +------------------+
```

### 3.2 Основные модули Backend

1. **Authentication** - Модуль аутентификации и авторизации
2. **Users** - Управление пользователями системы
3. **Clients** - Управление клиентами
4. **Services** - Управление услугами
5. **Branches** - Управление филиалами
6. **Appointments** - Управление записями
7. **Sales** - Управление продажами
8. **Notifications** - Система уведомлений
9. **Telegram** - Интеграция с Telegram Bot API

### 3.3 Структура базы данных

Схема базы данных включает следующие основные таблицы:

```
+------------------+     +------------------+     +------------------+
| Users            |     | Clients          |     | Services         |
+------------------+     +------------------+     +------------------+
| id               |     | id               |     | id               |
| name             |     | name             |     | name             |
| email            |     | phone            |     | description      |
| password         |     | telegram_id      |     | price            |
| role             |     | notes            |     | duration         |
| branch_id        |     |                  |     | category_id      |
+------------------+     +------------------+     +------------------+
        |                        |                        |
        |                        |                        |
        v                        v                        v
+------------------+     +------------------+     +------------------+
| Branches         |     | Appointments     |     | Sales            |
+------------------+     +------------------+     +------------------+
| id               |     | id               |     | id               |
| name             |     | client_id        |     | branch_id        |
| address          |     | service_id       |     | payment_method   |
| phone            |     | branch_id        |     |                  |
| working_hours    |     | date             |     |                  |
|                  |     | time             |     |                  |
|                  |     | status           |     |                  |
+------------------+     +------------------+     +------------------+
```

### 3.4 API Endpoints

API предоставляет следующие основные конечные точки:

1. **Аутентификация**
   - POST /api/auth/login - Авторизация пользователя
   - POST /api/auth/register - Регистрация нового пользователя

2. **Пользователи**
   - GET /api/users - Получение списка пользователей
   - POST /api/users - Создание пользователя
   - GET /api/users/:id - Получение информации о конкретном пользователе
   - PUT /api/users/:id - Обновление информации пользователя
   - DELETE /api/users/:id - Удаление пользователя

3. **Клиенты**
   - GET /api/clients - Получение списка клиентов
   - POST /api/clients - Создание клиента
   - GET /api/clients/:id - Получение информации о клиенте
   - PUT /api/clients/:id - Обновление информации клиента
   - DELETE /api/clients/:id - Удаление клиента

4. **Услуги, Филиалы, Записи**
   - Аналогичные эндпоинты для всех сущностей

## 4. Telegram Bot

### 4.1 Функциональность Telegram-бота

Telegram-бот предоставляет следующие возможности клиентам:

1. **Запись на прием**
   - Выбор филиала
   - Выбор услуги
   - Выбор даты и времени
   - Подтверждение заявки

2. **Управление записями**
   - Просмотр предстоящих записей
   - Отмена записи
   - История записей

3. **Информация**
   - Просмотр прайс-листа
   - Информация о филиалах
   - Часы работы

### 4.2 Схема взаимодействия клиента с ботом

```
 +-------+       +-------------+       +-----------+
 |       |       |             |       |           |
 | Start |------>| Главное     |------>| Запись на |
 |       |       | меню        |       | прием     |
 +-------+       +-------------+       +-----------+
                     |                      |
                     v                      v
               +-----------+       +-----------------+
               |           |       |                 |
               | Мои       |       | Ввод личных     |
               | записи    |       | данных          |
               +-----------+       +-----------------+
                     |                      |
                     v                      v
               +-----------+       +-----------------+
               |           |       |                 |
               | Прайс-    |       | Выбор филиала   |
               | лист      |       |                 |
               +-----------+       +-----------------+
                                          |
                                          v
                                   +-----------------+
                                   |                 |
                                   | Выбор услуги    |
                                   |                 |
                                   +-----------------+
                                          |
                                          v
                                   +-----------------+
                                   |                 |
                                   | Выбор даты и    |
                                   | времени         |
                                   +-----------------+
                                          |
                                          v
                                   +-----------------+
                                   |                 |
                                   | Подтверждение   |
                                   | записи          |
                                   +-----------------+
```

## 5. Интеграция компонентов

Все компоненты системы интегрированы между собой через API:

1. **Административная панель** обращается к Backend API для получения и изменения данных.
2. **Telegram Bot** также взаимодействует с Backend API для работы с записями, клиентами и другими сущностями.
3. **База данных** является единым источником данных для всей системы.

## 6. Безопасность

Система обеспечивает безопасность данных через:

1. **Аутентификацию** - JWT-токены для авторизации пользователей
2. **Авторизацию** - Ролевой доступ (администратор, менеджер, сотрудник)
3. **Защиту API** - Валидация входных данных, CORS, защита от инъекций
4. **Безопасность паролей** - Хеширование паролей с использованием bcrypt

## 7. Локализация

Система полностью локализована на русский язык, включая:

1. **Интерфейс** - Все элементы интерфейса на русском языке
2. **Календарь** - Русская локализация календаря (дни недели, месяцы)
3. **Сообщения** - Уведомления, ошибки и подсказки на русском языке
4. **Форматирование дат и времени** - В соответствии с российскими стандартами 